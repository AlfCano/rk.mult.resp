# rk.mult.resp: Multiple Response Analysis for RKWard

![Version](https://img.shields.io/badge/Version-0.0.4-blue.svg)
![License](https://img.shields.io/badge/License-GPL--3-green.svg)
![RKWard](https://img.shields.io/badge/Platform-RKWard-green)

This package provides a suite of RKWard plugins for analyzing **Multiple Response Sets** (also known as "Check-all-that-apply" questions). Powered by the **`expss`** and **`tidyverse`** packages, it brings SPSS-style tables and detailed pivot logic to RKWard.

## What's New in v0.0.4
*   **Smart Labeling:** The plugin now automatically detects **RKWard Variable Labels** (`rk.get.label`). If your variables are labeled (e.g., "Owns a Laptop"), the tables will display these labels instead of the raw variable names or numeric values.
*   **Enhanced Raw Counts:** The "Raw Counts (Pivot)" component now supports **Categorical Variables** (not just dichotomies) and includes options for **Row %**, **Column %**, and **Table %**.
*   **Tabbed UI:** The Crosstabs dialog has been reorganized into tabs for better usability.

## Features / Included Plugins

This package installs a new submenu in RKWard: **Analysis > Multiple Response (expss)**.

### 1. Define Variable Set
*   Define a reusable Multiple Response Set object (Dichotomies or Categories) and save it to your workspace.
*   **Auto-Transformation:** When defining a dichotomy set, the plugin automatically converts the "Counted Value" (e.g., 1) into the variable's Label for display purposes.
*   **Verification:** Includes a slot for a **Weight Variable** to preview weighted results immediately.

### 2. Multiple Response Frequencies
*   Calculate counts and percentages for response sets using `expss`.
*   **Flexible Input:** Use a Pre-defined Set object OR define variables on-the-fly.
*   **Weighting:** Apply a weight variable to calculate representative population estimates.

### 3. Multiple Response Crosstabs
*   Cross-tabulate a Multiple Response Set (Rows) against a categorical Grouping variable (Columns).
*   **Statistics:** Automatically calculates Column Percentages (Standard "Banner" table format).
*   **Smart Integration:** Automatically applies RKWard variable labels to the output rows.

### 4. Raw Counts (Pivot)
*   **Detailed Breakdown:** Creates a specific table for **every variable** in the set against a grouping variable.
*   **Statistics:** Toggle Counts, Row %, Column %, and Table %.
*   **Data Types:** Works with Dichotomies (0/1) and Categorical variables (Text/Factor).
*   **Margins:** Add Sum row/column margins.

## Requirements

1.  A working installation of **RKWard**.
2.  The following R packages must be installed:
    ```R
    install.packages(c("expss", "dplyr", "tidyr"))
    ```
3.  The R package **`remotes`** or **`devtools`** (for installation from source).

## Installation

1.  Open R in RKWard.
2.  Run the following commands in the R console:

```R
local({
  require(remotes)
  install_github("AlfCano/rk.mult.resp")
})
```
3.  Restart RKWard to ensure the new menu items appear correctly.

## Usage & Examples

### Step 0: Create Sample Data with Labels
To see the "Smart Labeling" feature in action, we define labels for our variables.

```R
# 1. Create Data
set.seed(123)
survey_data <- data.frame(
  gender = c("Male", "Female", "Female", "Male", "Male", "Female", "Male", "Female", "Male", "Female"),
  wt = runif(10, min=0.5, max=2.0),
  device_phone  = c(1, 1, 1, 1, 1, 1, 0, 1, 1, 1),
  device_tablet = c(0, 1, 1, 0, 0, 1, 0, 1, 0, 1),
  device_laptop = c(1, 1, 0, 1, 1, 0, 1, 1, 1, 0)
)

# 2. Apply RKWard Labels (The plugin looks for these!)
rk.set.label(survey_data[["device_phone"]], "Mobile Phone")
rk.set.label(survey_data[["device_tablet"]], "Tablet Device")
rk.set.label(survey_data[["device_laptop"]], "Laptop Computer")
```

### Example 1: Weighted Crosstabs
1.  Navigate to **Analysis > Multiple Response (expss) > Multiple Response Crosstabs**.
2.  **Column Variable (Group):** Select `gender`.
3.  **Weight Variable:** Select `wt`.
4.  **Set Definition (Option B):**
    *   **Variables:** Select `device_phone`, `device_tablet`, `device_laptop`.
    *   **Type:** Dichotomies.
    *   **Counted Value:** `1`.
    *   **Label:** "Devices Owned".
5.  Click **Submit**.
    *   *Result:* A weighted crosstab where the rows are labeled "Mobile Phone", "Tablet Device", etc., instead of "device_phone".

### Example 2: Raw Counts (Pivot)
1.  Navigate to **Analysis > Multiple Response (expss) > Raw Counts (Pivot)**.
2.  **Response Variables:** Select the three device variables.
3.  **Grouping Variable:** Select `gender`.
4.  **Statistics:** Check "Show Counts" and "Show Column %".
5.  Click **Submit**.
    *   *Result:* Three separate tables (one for each device), showing exactly how many Males/Females own (1) or don't own (0) the device, along with percentages.

## Author

**Alfonso Cano Robles** (<alfonso.cano@correo.buap.mx>)

*Assisted by Gemini, a large language model from Google.*
